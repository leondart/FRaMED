@lazy 
rule Fulfillment
	transform t : source!Relation
	to n : Sequence(target!Fulfillment) {
	
	guard : t.getType.getValue == 14 // enum value Fulfillment
	
	var transformed=false;
	//check source of fulfillment and fitting feature
	if(t.source.getType.getValue == 0 and t.~features.get("Compartments")) {
		if((t.source==t.target and t.~features.get("Playable_by_Defining_Compartment")) or not(t.source==t.target)) transformed=true;
	}
	if(t.source.getType.getValue == 1) transformed=true;
	if(t.source.getType.getValue == 3 and t.~features.get("Dates")) transformed=true;
	
	if(transformed){
		for(role : source!Shape in t.referencedRoles) {
			var fulfillment = new target!Fulfillment;
			fulfillment.filler ::= t.source;
			fulfillment.filled ::= role;
			n.add(fulfillment);
		}	
	}
}